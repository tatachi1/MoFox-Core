# è®°å¿†å›¾ç³»ç»Ÿ (Memory Graph System)

> å¤šå±‚æ¬¡ã€å¤šæ¨¡æ€çš„æ™ºèƒ½è®°å¿†ç®¡ç†æ¡†æ¶

ç‰ˆæœ¬ï¼šv2.1ï¼ˆ2025-12-22ï¼‰ â€” å¯¹é½å…­å±‚æ•°æ®åº“æ¶æ„ä¸ç»Ÿä¸€è°ƒåº¦å™¨ï¼Œè¡¥å……ç¤ºä¾‹ä¸ç›‘æ§å»ºè®®ã€‚

## ğŸ“š ç³»ç»Ÿæ¦‚è¿°

MoFox è®°å¿†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå—äººè„‘è®°å¿†æœºåˆ¶å¯å‘çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

| ç»„ä»¶ | åŠŸèƒ½ | ç”¨é€” |
|------|------|------|
| **ä¸‰å±‚è®°å¿†ç³»ç»Ÿ** | æ„ŸçŸ¥/çŸ­æœŸ/é•¿æœŸè®°å¿† | å¤„ç†æ¶ˆæ¯ã€æå–ä¿¡æ¯ã€æŒä¹…åŒ–å­˜å‚¨ |
| **è®°å¿†å›¾ç³»ç»Ÿ** | åŸºäºå›¾çš„çŸ¥è¯†åº“ | ç®¡ç†å®ä½“å…³ç³»ã€è®°å¿†æ¼”å˜ã€æ™ºèƒ½æ£€ç´¢ |
| **å…´è¶£å€¼ç³»ç»Ÿ** | åŠ¨æ€å…´è¶£è®¡ç®— | æ ¹æ®ç”¨æˆ·å…´è¶£è°ƒæ•´å¯¹è¯ç­–ç•¥ |

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ä¸‰å±‚è®°å¿†ç³»ç»Ÿ (Unified Memory Manager)
- **æ„ŸçŸ¥å±‚**: æ¶ˆæ¯å—ç¼“å†²ï¼ŒTopK æ¿€æ´»æ£€æµ‹
- **çŸ­æœŸå±‚**: ç»“æ„åŒ–ä¿¡æ¯æå–ï¼Œæ™ºèƒ½å†³ç­–åˆå¹¶
- **é•¿æœŸå±‚**: çŸ¥è¯†å›¾å­˜å‚¨ï¼Œå…³ç³»ç½‘ç»œï¼Œæ¿€æ´»åº¦ä¼ æ’­

### è®°å¿†å›¾ç³»ç»Ÿ (Memory Graph)
- **å›¾ç»“æ„å­˜å‚¨**: ä½¿ç”¨èŠ‚ç‚¹-è¾¹æ¨¡å‹è¡¨ç¤ºå¤æ‚è®°å¿†å…³ç³»
- **è¯­ä¹‰æ£€ç´¢**: åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½è®°å¿†æœç´¢
- **è‡ªåŠ¨æ•´åˆ**: å®šæœŸåˆå¹¶ç›¸ä¼¼è®°å¿†ï¼Œå‡å°‘å†—ä½™
- **æ™ºèƒ½é—å¿˜**: åŸºäºæ¿€æ´»åº¦çš„è‡ªåŠ¨è®°å¿†æ¸…ç†
- **LLMé›†æˆ**: æä¾›å·¥å…·ä¾›AIåŠ©æ‰‹è°ƒç”¨

### å…´è¶£å€¼ç³»ç»Ÿ (Interest System)
- **åŠ¨æ€è®¡ç®—**: æ ¹æ®æ¶ˆæ¯å®æ—¶è®¡ç®—ç”¨æˆ·å…´è¶£
- **ä¸»é¢˜èšç±»**: è‡ªåŠ¨è¯†åˆ«å’Œèšç±»æ„Ÿå…´è¶£çš„è¯é¢˜
- **ç­–ç•¥å½±å“**: å½±å“å¯¹è¯æ–¹å¼å’Œå†…å®¹é€‰æ‹©

## ï¿½ å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆ A: ä¸‰å±‚è®°å¿†ç³»ç»Ÿ (æ¨èæ–°ç”¨æˆ·)

æœ€ç®€å•çš„æ–¹å¼ï¼Œè‡ªåŠ¨å¤„ç†æ¶ˆæ¯æµå’Œè®°å¿†æ¼”å˜ï¼š

```toml
# config/bot_config.toml
[three_tier_memory]
enable = true
data_dir = "data/memory_graph/three_tier"
```

```python
from src.memory_graph.unified_manager_singleton import get_unified_manager

# æ·»åŠ æ¶ˆæ¯ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
unified_mgr = await get_unified_manager()
await unified_mgr.add_message(
    content="ç”¨æˆ·è¯´çš„è¯",
    sender_id="user_123"
)

# è·¨å±‚æœç´¢è®°å¿†
results = await unified_mgr.search_memories(
    query="æœç´¢å…³é”®è¯",
    top_k=5
)
```

**ç‰¹ç‚¹**ï¼šè‡ªåŠ¨è½¬ç§»ã€æ™ºèƒ½åˆå¹¶ã€åå°ç»´æŠ¤

### æ–¹æ¡ˆ B: è®°å¿†å›¾ç³»ç»Ÿ (é«˜çº§ç”¨æˆ·)

ç›´æ¥æ“ä½œçŸ¥è¯†å›¾ï¼Œæ‰‹åŠ¨ç®¡ç†è®°å¿†ï¼š

```toml
# config/bot_config.toml
[memory]
enable = true
data_dir = "data/memory_graph"
```

```python
from src.memory_graph.manager_singleton import get_memory_manager

manager = await get_memory_manager()

# åˆ›å»ºè®°å¿†
memory = await manager.create_memory(
    subject="ç”¨æˆ·",
    memory_type="åå¥½",
    topic="å–œæ¬¢æ™´å¤©",
    importance=0.7
)

# æœç´¢å’Œæ“ä½œ
memories = await manager.search_memories(query="å¤©æ°”", top_k=5)
node = await manager.create_node(node_type="person", label="ç”¨æˆ·å")
edge = await manager.create_edge(
    source_id="node_1",
    target_id="node_2",
    relation_type="knows"
)
```

**ç‰¹ç‚¹**ï¼šçµæ´»æ€§é«˜ã€æ§åˆ¶åŠ›å¼º

### åŒæ—¶å¯ç”¨ä¸¤ä¸ªç³»ç»Ÿ

æ¨èçš„ç”Ÿäº§é…ç½®ï¼š

```toml
[three_tier_memory]
enable = true
data_dir = "data/memory_graph/three_tier"

[memory]
enable = true
data_dir = "data/memory_graph"

[interest]
enable = true
```

## ï¿½ æ ¸å¿ƒé…ç½®

### ä¸‰å±‚è®°å¿†ç³»ç»Ÿ
```toml
[three_tier_memory]
enable = true
data_dir = "data/memory_graph/three_tier"
perceptual_max_blocks = 50              # æ„ŸçŸ¥å±‚æœ€å¤§å—æ•°
short_term_max_memories = 100           # çŸ­æœŸå±‚æœ€å¤§è®°å¿†æ•°
short_term_transfer_threshold = 0.6     # è½¬ç§»åˆ°é•¿æœŸçš„é‡è¦æ€§é˜ˆå€¼
long_term_auto_transfer_interval = 600  # è‡ªåŠ¨è½¬ç§»é—´éš”(ç§’)
```

### è®°å¿†å›¾ç³»ç»Ÿ
```toml
[memory]
enable = true
data_dir = "data/memory_graph"
search_top_k = 5                        # æ£€ç´¢æ•°é‡
consolidation_interval_hours = 1.0      # æ•´åˆé—´éš”
forgetting_activation_threshold = 0.1   # é—å¿˜é˜ˆå€¼
```

### å…´è¶£å€¼ç³»ç»Ÿ
```toml
[interest]
enable = true
max_topics = 10                         # æœ€å¤šè·Ÿè¸ªè¯é¢˜
time_decay_factor = 0.95                # æ—¶é—´è¡°å‡å› å­
update_interval = 300                   # æ›´æ–°é—´éš”(ç§’)
```

**å®Œæ•´é…ç½®å‚è€ƒ**: 
- ğŸ“– [MEMORY_SYSTEM_OVERVIEW.md](MEMORY_SYSTEM_OVERVIEW.md#é…ç½®è¯´æ˜) - è¯¦ç»†é…ç½®è¯´æ˜
- ğŸ“– [MEMORY_SYSTEM_QUICK_REFERENCE.md](MEMORY_SYSTEM_QUICK_REFERENCE.md) - å¿«é€Ÿå‚è€ƒè¡¨

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### å¿«é€Ÿå…¥é—¨
- ğŸ”¥ **[å¿«é€Ÿå‚è€ƒå¡](MEMORY_SYSTEM_QUICK_REFERENCE.md)** - å¸¸ç”¨å‘½ä»¤å’Œå¿«é€ŸæŸ¥è¯¢ï¼ˆ5åˆ†é’Ÿï¼‰

### ç”¨æˆ·æŒ‡å—
- ğŸ“– **[å®Œæ•´ç³»ç»ŸæŒ‡å—](MEMORY_SYSTEM_OVERVIEW.md)** - ä¸‰å±‚ç³»ç»Ÿã€è®°å¿†å›¾ã€å…´è¶£å€¼è¯¦è§£ï¼ˆ30åˆ†é’Ÿï¼‰
- ğŸ“– **[ä¸‰å±‚è®°å¿†æŒ‡å—](three_tier_memory_user_guide.md)** - æ„ŸçŸ¥/çŸ­æœŸ/é•¿æœŸå±‚å·¥ä½œæµï¼ˆ20åˆ†é’Ÿï¼‰
- ğŸ“– **[è®°å¿†å›¾æŒ‡å—](memory_graph_guide.md)** - LLMå·¥å…·ã€è®°å¿†æ“ä½œã€é«˜çº§ç”¨æ³•ï¼ˆ20åˆ†é’Ÿï¼‰

### å¼€å‘æŒ‡å—
- ğŸ› ï¸ **[å¼€å‘è€…æŒ‡å—](MEMORY_SYSTEM_DEVELOPER_GUIDE.md)** - æ¨¡å—è¯¦è§£ã€å¼€å‘æµç¨‹ã€é›†æˆæ–¹æ¡ˆï¼ˆ1å°æ—¶ï¼‰
- ğŸ› ï¸ **[åŸæœ‰APIå‚è€ƒ](../src/memory_graph/README.md)** - ä»£ç çº§APIæ–‡æ¡£

### å­¦ä¹ è·¯å¾„

**æ–°æ‰‹ç”¨æˆ·** (1å°æ—¶):
- 1. é˜…è¯»æœ¬ README (5åˆ†é’Ÿ)
- 2. æŸ¥çœ‹å¿«é€Ÿå‚è€ƒå¡ (5åˆ†é’Ÿ)
- 3. è¿è¡Œå¿«é€Ÿå¼€å§‹ç¤ºä¾‹ (10åˆ†é’Ÿ)
- 4. é˜…è¯»å®Œæ•´ç³»ç»ŸæŒ‡å—çš„ä½¿ç”¨éƒ¨åˆ† (30åˆ†é’Ÿ)
- 5. åœ¨æ’ä»¶ä¸­é›†æˆè®°å¿† (10åˆ†é’Ÿ)

**å¼€å‘è€…** (3å°æ—¶):
- 1. å¿«é€Ÿå…¥é—¨ (1å°æ—¶)
- 2. é˜…è¯»ä¸‰å±‚è®°å¿†æŒ‡å— (20åˆ†é’Ÿ)
- 3. é˜…è¯»è®°å¿†å›¾æŒ‡å— (20åˆ†é’Ÿ)
- 4. é˜…è¯»å¼€å‘è€…æŒ‡å— (60åˆ†é’Ÿ)
- 5. å®ç°è‡ªå®šä¹‰è®°å¿†ç±»å‹ (20åˆ†é’Ÿ)

**è´¡çŒ®è€…** (8å°æ—¶+):
- 1. å®Œæ•´å­¦ä¹ æ‰€æœ‰æŒ‡å— (3å°æ—¶)
- 2. ç ”ç©¶æºä»£ç  (2å°æ—¶)
- 3. ç†è§£å›¾ç®—æ³•å’Œå‘é‡è¿ç®— (1å°æ—¶)
- 4. å®ç°é«˜çº§åŠŸèƒ½ (2å°æ—¶)
- 5. ç¼–å†™æµ‹è¯•å’Œæ–‡æ¡£ (ongoing)

## âœ… å¼€å‘çŠ¶æ€

### ä¸‰å±‚è®°å¿†ç³»ç»Ÿ (Phase 3)
- [x] æ„ŸçŸ¥å±‚å®ç°
- [x] çŸ­æœŸå±‚å®ç°
- [x] é•¿æœŸå±‚å®ç°
- [x] è‡ªåŠ¨è½¬ç§»å’Œç»´æŠ¤
- [x] é›†æˆæµ‹è¯•

### è®°å¿†å›¾ç³»ç»Ÿ (Phase 2)
- [x] æ’ä»¶ç³»ç»Ÿé›†æˆ
- [x] æç¤ºè¯è®°å¿†æ£€ç´¢
- [x] å®šæœŸè®°å¿†æ•´åˆ
- [x] é…ç½®ç³»ç»Ÿæ”¯æŒ
- [x] é›†æˆæµ‹è¯•

### å…´è¶£å€¼ç³»ç»Ÿ (Phase 2)
- [x] åŸºç¡€è®¡ç®—æ¡†æ¶
- [x] ç»„ä»¶ç®¡ç†å™¨
- [x] AFC ç­–ç•¥é›†æˆ
- [ ] é«˜çº§èšç±»ç®—æ³•
- [ ] è¶‹åŠ¿åˆ†æ

### ğŸ“ è®¡åˆ’ä¼˜åŒ–
- [ ] å‘é‡æ£€ç´¢æ€§èƒ½ä¼˜åŒ– (FAISSé›†æˆ)
- [ ] å›¾éå†ç®—æ³•ä¼˜åŒ–
- [ ] æ›´å¤šLLMå·¥å…·ç¤ºä¾‹
- [ ] å¯è§†åŒ–ç•Œé¢

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æ¶ˆæ¯/LLM è°ƒç”¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸‰å±‚è®°å¿†ç³»ç»Ÿ     â”‚ â”‚  è®°å¿†å›¾ç³»ç»Ÿ      â”‚ â”‚  å…´è¶£å€¼ç³»ç»Ÿ      â”‚
â”‚  Unified Manager â”‚ â”‚  MemoryManager   â”‚ â”‚  InterestMgr     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚             â”‚               â”‚
    â–¼                      â–¼             â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ„ŸçŸ¥å±‚  â”‚        â”‚ å‘é‡å­˜å‚¨   â”‚  â”‚ å›¾å­˜å‚¨   â”‚   â”‚ å…´è¶£    â”‚
â”‚Percept  â”‚        â”‚Vector Storeâ”‚  â”‚GraphStoreâ”‚   â”‚è®¡ç®—å™¨   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚              â”‚
     â–¼                    â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚              â”‚
â”‚ çŸ­æœŸå±‚  â”‚               â”‚              â”‚
â”‚Short    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
     â”‚                    â”‚
     â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      é•¿æœŸå±‚/è®°å¿†å›¾å­˜å‚¨           â”‚
â”‚  â”œâ”€ å‘é‡ç´¢å¼•                    â”‚
â”‚  â”œâ”€ å›¾æ•°æ®åº“                    â”‚
â”‚  â””â”€ æŒä¹…åŒ–å­˜å‚¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸‰å±‚è®°å¿†æµå‘**:
æ¶ˆæ¯ â†’ æ„ŸçŸ¥å±‚(ç¼“å†²) â†’ æ¿€æ´»æ£€æµ‹ â†’ çŸ­æœŸå±‚(ç»“æ„åŒ–) â†’ é•¿æœŸå±‚(å›¾å­˜å‚¨)

## ğŸ§© æ¶æ„å¯¹é½ä¸é›†æˆï¼ˆæ–°å¢ï¼‰

- æ•°æ®åº“è®¿é—®ï¼šç»Ÿä¸€ä½¿ç”¨æ•°æ®åº“ API å±‚ï¼ˆCRUDBase/QueryBuilderï¼‰ï¼Œé¿å…ç›´æ¥ä½¿ç”¨ Sessionï¼›æ‰¹é‡æ’å…¥/æ›´æ–°ä¼˜å…ˆ `AdaptiveBatchScheduler`ï¼Œå‡å°‘é€æ¡å†™å…¥ã€‚
- ç»Ÿä¸€è°ƒåº¦å™¨ï¼šå°†â€œè®°å¿†æ•´ç†/èŠ‚ç‚¹å»é‡/æ—¶é—´è¡°å‡/åµŒå…¥åˆ·æ–°â€ç­‰åå°åŒ–ï¼Œé‡‡ç”¨ TIME/äº‹ä»¶åŒè§¦å‘ï¼Œé™ä½ä¸»æµç¨‹é˜»å¡ã€‚
- äº‹ä»¶ç³»ç»Ÿï¼šåœ¨ `ON_MESSAGE_RECEIVED` ç­‰äº‹ä»¶ä¸­è¿›è¡Œè½»é‡å¤„ç†ï¼ˆå…¥ä¸´æ—¶æ± /æ ‡è®°ï¼‰ï¼Œé‡æ´»ç”±è°ƒåº¦å™¨å¼‚æ­¥æ‰§è¡Œã€‚
- æƒé™ä¸å®¡è®¡ï¼šæ•æ„Ÿæ“ä½œï¼ˆæ‰¹é‡æ¸…ç†/å¯¼å‡º/åˆå¹¶ï¼‰éœ€ç®¡ç†å‘˜æˆ– Master æƒé™ï¼Œå¹¶è®°å½•ç»“æ„åŒ–å®¡è®¡æ—¥å¿—ã€‚

å‚è€ƒï¼š
- [design_outline.md](design_outline.md)ï¼ˆæ€»ä½“æ¶æ„ä¸è°ƒåº¦/äº‹ä»¶/æƒé™å¯¹æ¥ï¼‰
- [long_term_manager_optimization_summary.md](long_term_manager_optimization_summary.md)ï¼ˆä¼˜åŒ–è¦ç‚¹ä¸å®è·µç¤ºä¾‹ï¼‰

## ï¿½ å¸¸è§åœºæ™¯

### åœºæ™¯ 1: è®°ä½ç”¨æˆ·åå¥½
```python
# è‡ªåŠ¨å¤„ç† - ä¸‰å±‚ç³»ç»Ÿä¼šè‡ªåŠ¨å­¦ä¹ 
await unified_manager.add_message(
    content="æˆ‘å–œæ¬¢ä¸‹é›¨å¤©",
    sender_id="user_123"
)

# ä¸‹æ¬¡å¯¹è¯æ—¶è‡ªåŠ¨åº”ç”¨
memories = await unified_manager.search_memories(
    query="å¤©æ°”åå¥½"
)
```

### åœºæ™¯ 2: è®°å½•é‡è¦äº‹ä»¶
```python
# æ˜¾å¼åˆ›å»ºé«˜é‡è¦æ€§è®°å¿†
memory = await memory_manager.create_memory(
    subject="ç”¨æˆ·",
    memory_type="äº‹ä»¶",
    topic="å‚åŠ äº†ä¸€ä¸ªé‡è¦ä¼šè®®",
    content="è¯¦ç»†ä¿¡æ¯...",
    importance=0.9  # é«˜é‡è¦æ€§ï¼Œä¸ä¼šé—å¿˜
)
```

### åœºæ™¯ 3: å»ºç«‹å…³ç³»ç½‘ç»œ
```python
# åˆ›å»ºäººç‰©å’Œå…³ç³»
user_node = await memory_manager.create_node(
    node_type="person",
    label="å°ç‹"
)
friend_node = await memory_manager.create_node(
    node_type="person",
    label="å°æ"
)

# å»ºç«‹å…³ç³»
await memory_manager.create_edge(
    source_id=user_node.id,
    target_id=friend_node.id,
    relation_type="knows",
    weight=0.9
)
```

## ğŸ§ª æµ‹è¯•å’Œç›‘æµ‹

### è¿è¡Œæµ‹è¯•
```bash
# é›†æˆæµ‹è¯•
python -m pytest tests/test_memory_graph_integration.py -v

# ä¸‰å±‚è®°å¿†æµ‹è¯•
python -m pytest tests/test_three_tier_memory.py -v

# å…´è¶£å€¼ç³»ç»Ÿæµ‹è¯•
python -m pytest tests/test_interest_system.py -v
```

### æŸ¥çœ‹ç»Ÿè®¡
```python
from src.memory_graph.manager_singleton import get_memory_manager

manager = await get_memory_manager()
stats = await manager.get_statistics()
print(f"è®°å¿†æ€»æ•°: {stats['total_memories']}")
print(f"èŠ‚ç‚¹æ€»æ•°: {stats['total_nodes']}")
print(f"å¹³å‡æ¿€æ´»åº¦: {stats['avg_activation']:.2f}")

### ç›‘æ§ä¸æ—¥å¿—ï¼ˆæ–°å¢ï¼‰
- ç»“æ„åŒ–æ—¥å¿—ï¼šè®°å½•æ‰¹é‡å¤§å°ã€å¤„ç†è€—æ—¶ã€ç¼“å­˜å‘½ä¸­ç‡ä¸é”™è¯¯æ˜ç»†ï¼ˆè§ logs/ ç›®å½•çš„ app_*.jsonlï¼‰ã€‚
- æŒ‡æ ‡é‡‡é›†ï¼šå¤„ç†é€Ÿåº¦ã€å¹³å‡å»¶è¿Ÿã€å†…å­˜ä½¿ç”¨ã€æ‰¹å¤„ç†å¤§å°ã€ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå»ºè®®ä¸ŠæŠ¥åˆ°ç›‘æ§æˆ–å®šæœŸå¯¼å‡ºï¼‰ã€‚

## ğŸ”§ å®è·µç¤ºä¾‹ï¼ˆæ–°å¢ï¼‰

æ›´å¤šå®Œæ•´ç¤ºä¾‹è§ï¼š[long_term_manager_optimization_summary.md](long_term_manager_optimization_summary.md#å®è·µç¤ºä¾‹æ–°å¢)

ç®€è¦ç¤ºä¾‹ï¼šç»Ÿä¸€è°ƒåº¦å™¨æ³¨å†Œå‘¨æœŸæ•´ç†ä»»åŠ¡

```python
from src.schedule.unified_scheduler import unified_scheduler, TriggerType

async def register_consolidation_tasks():
    await unified_scheduler.create_schedule(
        callback=run_memory_consolidation,           # æ•´ç†å…¥å£
        trigger_type=TriggerType.TIME,
        trigger_config={"delay_seconds": 6 * 3600},
        is_recurring=True,
        task_name="periodic_memory_consolidation"
    )
```
```

## ğŸ”— ç›¸å…³èµ„æº

### æ ¸å¿ƒæ–‡ä»¶
- `src/memory_graph/unified_manager.py` - ä¸‰å±‚ç³»ç»Ÿç®¡ç†å™¨
- `src/memory_graph/manager.py` - è®°å¿†å›¾ç®¡ç†å™¨  
- `src/memory_graph/models.py` - æ•°æ®æ¨¡å‹å®šä¹‰
- `src/chat/interest_system/` - å…´è¶£å€¼ç³»ç»Ÿ
- `config/bot_config.toml` - é…ç½®æ–‡ä»¶

### ç›¸å…³ç³»ç»Ÿ
- ğŸ“š [æ•°æ®åº“ç³»ç»Ÿ](../docs/database_refactoring_completion.md) - SQLAlchemy æ¶æ„
- ğŸ“š [æ’ä»¶ç³»ç»Ÿ](../src/plugin_system/) - LLMå·¥å…·é›†æˆ
- ğŸ“š [å¯¹è¯ç³»ç»Ÿ](../src/chat/) - AFC ç­–ç•¥é›†æˆ
- ğŸ“š [é…ç½®ç³»ç»Ÿ](../src/config/config.py) - å…¨å±€é…ç½®ç®¡ç†

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**Q: è®°å¿†æ²¡æœ‰è½¬ç§»åˆ°é•¿æœŸå±‚ï¼Ÿ**
A: æ£€æŸ¥çŸ­æœŸè®°å¿†çš„é‡è¦æ€§æ˜¯å¦ â‰¥ 0.6ï¼Œæˆ–æŸ¥çœ‹ `short_term_transfer_threshold` é…ç½®

**Q: æœç´¢ä¸åˆ°è®°å¿†ï¼Ÿ**
A: æ£€æŸ¥ç›¸ä¼¼åº¦é˜ˆå€¼è®¾ç½®ï¼Œå°è¯•é™ä½ `search_similarity_threshold`

**Q: ç³»ç»Ÿå ç”¨ç£ç›˜è¿‡å¤§ï¼Ÿ**
A: å¯ç”¨æ›´ç§¯æçš„é—å¿˜æœºåˆ¶ï¼Œè°ƒæ•´ `forgetting_activation_threshold`

**æ›´å¤šé—®é¢˜**: æŸ¥çœ‹ [å®Œæ•´ç³»ç»ŸæŒ‡å—](MEMORY_SYSTEM_OVERVIEW.md#å¸¸è§é—®é¢˜) æˆ– [å¿«é€Ÿå‚è€ƒ](MEMORY_SYSTEM_QUICK_REFERENCE.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ PRï¼

### è´¡çŒ®æŒ‡å—
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹æ–‡æ¡£: [å®Œæ•´æŒ‡å—](MEMORY_SYSTEM_OVERVIEW.md)
- ğŸ’¬ GitHub Issues: æäº¤ bug æˆ–åŠŸèƒ½è¯·æ±‚
- ğŸ“§ è”ç³»å›¢é˜Ÿ: é€šè¿‡å®˜æ–¹æ¸ é“

## ğŸ“„ License

MIT License - æŸ¥çœ‹ [LICENSE](../LICENSE) æ–‡ä»¶

---

**MoFox Bot** - æ›´æ™ºèƒ½çš„è®°å¿†ç®¡ç†  
æ›´æ–°äº: 2025å¹´12æœˆ22æ—¥ | ç‰ˆæœ¬: 2.1

---

## å˜æ›´è®°å½•ï¼ˆChangelogï¼‰

### v2.1ï¼ˆ2025-12-22ï¼‰
- å¯¹é½é¡¹ç›®çš„å…­å±‚æ•°æ®åº“æ¶æ„ä¸ä¼˜åŒ–å±‚ï¼šå»ºè®®ä½¿ç”¨ CRUDBase/QueryBuilder ä¸ AdaptiveBatchSchedulerã€‚
- æ•´åˆç»Ÿä¸€è°ƒåº¦å™¨ï¼šå°†æ•´ç†/è¡°å‡/åµŒå…¥åˆ·æ–°åå°åŒ–ï¼Œæ–°å¢ç¤ºä¾‹ä¸ç›‘æ§å»ºè®®ã€‚
- åŠ å¼ºäº‹ä»¶ä¸æƒé™è¯´æ˜ï¼šä¸»è·¯å¾„è½»é‡åŒ–ï¼Œæ•æ„Ÿæ“ä½œæƒé™æ§åˆ¶ä¸å®¡è®¡è¦æ±‚ã€‚
